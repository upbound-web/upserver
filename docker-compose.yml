services:
  backend:
    build: ./backend
    container_name: upserver-backend
    restart: unless-stopped
    ports:
      - "4000:4000"
      # Expose range for dev servers (staging sites)
      # You can point Cloudflare Tunnels to localhost:3100, localhost:3101, etc.
      - "3100-3150:3100-3150"
    volumes:
      - ./sites:/app/sites
      - ./backend/database:/app/database
    env_file:
      - ./backend/.env
      - ./frontend/.env
    environment:
      - NODE_ENV=production
      - PORT=4000
      - SITES_DIR=/app/sites
      # Update this to your public frontend URL if accessing via a separate API domain
      # e.g. https://upserver.com
      - FRONTEND_URL=http://localhost:4099
      # Range for dev servers
      - DEV_SERVER_START_PORT=3100
    extra_hosts:
      - "host.docker.internal:host-gateway"

  frontend:
    build:
      context: ./frontend
      args:
        - VITE_BACKEND_URL=${VITE_BACKEND_URL:-http://localhost:4000}
    container_name: upserver-frontend
    restart: unless-stopped
    ports:
      - "4099:80"
    depends_on:
      - backend

